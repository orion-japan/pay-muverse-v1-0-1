/* =========================================================
   SofiaChat – perfect pinning (header / meta / input)
   ========================================================= */

/* ---- Tokens ---- */
:root{
  --sof-shell-w: min(960px, calc(100vw - 24px)); /* 共通幅 */
  --sof-thread-w: min(780px, calc(100vw - 48px));/* スレッド幅 */

  --sof-header-h: 56px;                          /* Header 高さ */

  --footer-safe-pad: var(--footer-h, 60px);      /* PAY フッター高（LayoutClient が上書き） */
  --compose-height: 64px;                         /* 入力の実高（JSで上書き） */
  --meta-height: 48px;                            /* Meta の実高（だいたい / 小さめでOK） */
  --safe-bottom: env(safe-area-inset-bottom, 0px);

  --sof-border: 1px solid #e6e6e6;
  --sof-bg: #fff;
  --sof-bg-page: #f7f8fb;
  --sof-shadow-top: 0 -2px 10px rgba(0,0,0,.06);
}

/* =========================================================
   Scaffold
   ========================================================= */
.sofia-container{
  min-height: 100dvh;
  display: flex;
  flex-direction: column;
  background: var(--sof-bg-page);
}
.sofia-page-main{ flex: 1 1 auto; overflow-y: auto; }
.sofia-page-wrap{
  width: var(--sof-shell-w);
  margin: 0 auto;
  padding-top: calc(var(--sof-header-h) + 12px); /* Header 分の逃げ */
}

/* 共通で中央寄せしたい箱 */
.sof-header-slot,
.sof-meta-dock,
.sof-compose-dock,
.sofia-page-wrap{
  width: var(--sof-shell-w);
  margin-left: auto;
  margin-right: auto;
}

/* =========================================================
   HEADER: 中身は触らず“入れ物”だけ固定
   ========================================================= */
.sof-header-slot{
  position: sticky;   /* スクロールしても上に残る */
  top: 0;
  z-index: 40;        /* meta(50) / input(60) より下でOK */
  height: var(--sof-header-h);
  display: flex;      /* 子(Header)を縦中央に */
  align-items: center;
  padding: 0 0;       /* Header 自体の余白に任せる */
  background: linear-gradient(180deg,#fafafa,#ffffff);
  border-bottom: 1px solid #e5e7eb;
  box-shadow: 0 2px 8px rgba(0,0,0,.06);
}

/* Header の中身（ボタン・タイトル）は一切指定しない
   → これでボタンや文字のズレが起きません */

/* =========================================================
   MESSAGE LIST
   ========================================================= */
.sof-msgs{
  width: var(--sof-thread-w);
  margin: 0 auto;

  display: flex;
  flex-direction: column;
  gap: 10px;

  padding: 8px 12px;
  /* 下側は固定 UI(footer + meta + input) に被らないよう余白を確保 */
  padding-bottom: calc(var(--footer-safe-pad) + var(--meta-height) + var(--compose-height) + 24px);

  align-items: stretch;
  text-align: initial;
}

.sof-empty{ color:#94a3b8; text-align:center; padding:24px 8px; font-size:14px; }

/* バブル */
.sof-bubble{
  max-width: 86%;
  padding: 10px 14px;
  border-radius: 16px;
  line-height: 1.6;
  font-size: 14px;
  word-break: break-word;
  background: #ffffff;
  border: 1px solid #e5e7eb;
  box-shadow: 0 1px 2px rgba(0,0,0,.04);

  align-self: flex-start;
  margin-left: 0;
  margin-right: auto;
}
.sof-bubble.is-user{
  align-self: flex-end;
  margin-left: 0; margin-right: 0;
  background: #6b8cff; color:#fff; border-color:#6b8cff;
  border-bottom-right-radius: 4px;
}
.sof-bubble.is-assistant{
  align-self: flex-start;
  margin-left: 0; margin-right: auto;
  background: #f8fafc; color:#111827; border-color:#e5e7eb;
  border-bottom-left-radius: 4px;
}
.sof-bubble__role{ font-size:11px; letter-spacing:.02em; color:#94a3b8; }
.sof-bubble.is-user .sof-bubble__role{ color:rgba(255,255,255,.8); }
.sof-bubble__text{ white-space: pre-wrap; }

.sof-bubble__imgs{ display:grid; grid-template-columns:repeat(auto-fill,minmax(96px,1fr)); gap:6px; }
.sof-bubble__imgs img{
  width:100%; height:96px; object-fit:cover; border-radius:10px;
  border:1px solid #e5e7eb; background:#fff;
}

@media (max-width: 480px){
  .sof-bubble{ max-width: 92%; }
}

/* =========================================================
   META (indicator) – フッター直上（中身があるときだけ）
   ========================================================= */
.sof-meta-dock{
  position: fixed;
  left: 50%;
  transform: translateX(-50%);
  bottom: var(--footer-safe-pad);    /* ← フッターのすぐ上 */
  z-index: 50;

  padding: 8px 12px 6px;
  background: rgba(255,255,255,.95);
  -webkit-backdrop-filter: blur(6px);
  backdrop-filter: blur(6px);

  border-top: var(--sof-border);
  box-shadow: var(--sof-shadow-top);
}

/* MetaPanel 側の強制上書き（“緑の帯”などの癖を消す） */
.sof-meta-dock .meta-panel{
  background: #fff !important;
  border: 1px solid #e5e7eb !important;
  box-shadow: none !important;
}
.sof-meta-dock .meta-label{
  border-left: none !important;
  color: #667085;
}

/* =========================================================
   INPUT – Meta のさらに上
   ========================================================= */
.sof-compose-dock{
  position: fixed;
  left: 50%;
  transform: translateX(-50%);
  bottom: calc(var(--footer-safe-pad) + var(--meta-height)); /* ← Meta 分だけ持ち上げ */
  z-index: 60;

  background: rgba(255,255,255,0.95);
  -webkit-backdrop-filter: blur(6px);
  backdrop-filter: blur(6px);
  border-top: var(--sof-border);
  box-shadow: var(--sof-shadow-top);
  padding: 8px 12px calc(8px + var(--safe-bottom));
}

/* さらに保険で“物理スペーサ”を使う場合（任意） */
.sof-footer-spacer{
  height: calc(var(--footer-safe-pad) + var(--meta-height) + var(--compose-height) + 24px);
}

@media (max-width: 640px){
  :root{
    --sof-shell-w: calc(100vw - 12px);
    --sof-thread-w: calc(100vw - 24px);
  }
  .sof-footer-spacer{
    height: calc(var(--footer-safe-pad) + var(--meta-height) + var(--compose-height) + 36px);
  }
}

/* =========================================================
   mu-main の変な装飾を殺す（縦の色線など）
   ========================================================= */
body.mu-body .mu-main:before,
body.mu-body .mu-main:after{
  content: none !important;
  display: none !important;
}

:root{
  --sof-shell-w: min(960px, calc(100vw - 24px));
  --sof-thread-w: min(780px, calc(100vw - 48px));
  --sof-header-h: 56px;

  --footer-safe-pad: var(--footer-h, 60px);
  --compose-height: 64px;
  --meta-height: 48px;
  --safe-bottom: env(safe-area-inset-bottom, 0px);

  --sof-border: 1px solid #e6e6e6;
  --sof-bg: #fff;
  --sof-bg-page: #f7f8fb;
  --sof-shadow-top: 0 -2px 10px rgba(0,0,0,.06);
}

/* Layout */
.sofia-container{ min-height:100dvh; display:flex; flex-direction:column; background:var(--sof-bg-page); }
.sofia-page-main{ flex:1 1 auto; overflow-y:auto; }
.sofia-page-wrap{ width:var(--sof-shell-w); margin:0 auto; padding-top:calc(var(--sof-header-h) + 12px); }

.sof-header-slot,.sof-meta-dock,.sof-compose-dock,.sofia-page-wrap{
  width:var(--sof-shell-w); margin-left:auto; margin-right:auto;
}

/* Header（中身に触らない） */
.sof-header-slot{
  position: sticky; top: 0; z-index: 40;
  height: var(--sof-header-h);
  display:flex; align-items:center;
  background: linear-gradient(180deg,#fafafa,#ffffff);
  border-bottom: 1px solid #e5e7eb;
  box-shadow: 0 2px 8px rgba(0,0,0,.06);
}

/* Message list */
.sof-msgs{
  width:var(--sof-thread-w); margin:0 auto;
  display:flex; flex-direction:column; gap:10px;
  padding:8px 12px;
  padding-bottom: calc(var(--footer-safe-pad) + var(--meta-height) + var(--compose-height) + 24px);
  align-items:stretch; text-align:initial;
}
.sof-empty{ color:#94a3b8; text-align:center; padding:24px 8px; font-size:14px; }

.sof-bubble{
  max-width:86%; padding:10px 14px; border-radius:16px; line-height:1.6; font-size:14px;
  word-break:break-word; background:#fff; border:1px solid #e5e7eb; box-shadow:0 1px 2px rgba(0,0,0,.04);
  align-self:flex-start; margin-left:0; margin-right:auto;
}
.sof-bubble.is-user{
  align-self:flex-end; margin-left:0; margin-right:0;
  background:#6b8cff; color:#fff; border-color:#6b8cff; border-bottom-right-radius:4px;
}
.sof-bubble.is-assistant{
  align-self:flex-start; margin-left:0; margin-right:auto;
  background:#f8fafc; color:#111827; border-color:#e5e7eb; border-bottom-left-radius:4px;
}
.sof-bubble__role{ font-size:11px; letter-spacing:.02em; color:#94a3b8; }
.sof-bubble.is-user .sof-bubble__role{ color:rgba(255,255,255,.8); }
.sof-bubble__text{ white-space: pre-wrap; }
.sof-bubble__imgs{ display:grid; grid-template-columns:repeat(auto-fill,minmax(96px,1fr)); gap:6px; }
.sof-bubble__imgs img{ width:100%; height:96px; object-fit:cover; border-radius:10px; border:1px solid #e5e7eb; background:#fff; }

@media (max-width:480px){ .sof-bubble{ max-width:92%; } }

/* Meta（ある時だけ白カード・固定） */
.sof-meta-dock{
  position: fixed; left:50%; transform:translateX(-50%);
  bottom: var(--footer-safe-pad); z-index:50;
  padding:8px 12px 6px; background:rgba(255,255,255,.95);
  -webkit-backdrop-filter: blur(6px); backdrop-filter: blur(6px);
  border-top: var(--sof-border); box-shadow: var(--sof-shadow-top);
}
.sof-meta-dock .meta-panel{ background:#fff !important; border:1px solid #e5e7eb !important; box-shadow:none !important; }
.sof-meta-dock .meta-label{ border-left:none !important; color:#667085; }

/* Input（Meta のさらに上） */
.sof-compose-dock{
  position: fixed; left:50%; transform:translateX(-50%);
  bottom: calc(var(--footer-safe-pad) + var(--meta-height)); z-index:60;
  background:rgba(255,255,255,.95); -webkit-backdrop-filter: blur(6px); backdrop-filter: blur(6px);
  border-top: var(--sof-border); box-shadow: var(--sof-shadow-top);
  padding: 8px 12px calc(8px + var(--safe-bottom));
}

/* 物理スペーサ（保険） */
.sof-footer-spacer{ height: calc(var(--footer-safe-pad) + var(--meta-height) + var(--compose-height) + 24px); }

@media (max-width:640px){
  :root{ --sof-shell-w: calc(100vw - 12px); --sof-thread-w: calc(100vw - 24px); }
  .sof-footer-spacer{ height: calc(var(--footer-safe-pad) + var(--meta-height) + var(--compose-height) + 36px); }
}

/* mu-main の縦色線などを無効化 */
body.mu-body .mu-main:before,
body.mu-body .mu-main:after{ content:none !important; display:none !important; }


/* ===== SofiaChat Header 固定レイアウト ===== */
.sof-header-fixed {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;

  height: var(--sof-header-h);
  z-index: 100;

  display: flex;
  justify-content: center;   /* 中央にボックスを置く */
  align-items: center;

  background: linear-gradient(180deg, #fafafa 0%, #ffffff 100%);
  border-bottom: 1px solid #e5e7eb;
  box-shadow: 0 2px 8px rgba(0,0,0,.06);
}

/* 内側の Header コンポーネントを共通幅に制御 */
.sof-header-fixed > .sof-header {
  width: var(--sof-shell-w);
  margin: 0 auto;

  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 8px;

  height: 100%;
  padding: 0 12px;
}

/* タイトル */
.sof-header__title {
  flex: 1;
  text-align: center;
  font-size: 16px;
  font-weight: 700;
  color: #111827;
}

/* ボタン */
.sof-header .sof-btn {
  font-size: 14px;
  font-weight: 600;
  padding: 6px 12px;
  border-radius: 8px;
  border: 1px solid #d1d5db;
  background: #ffffff;
  color: #374151;
  cursor: pointer;
  transition: background .15s, color .15s, border-color .15s;
}
.sof-header .sof-btn:hover { background: #f3f4f6; }
.sof-header .sof-btn.primary {
  background: #6b8cff;
  border-color: #6b8cff;
  color: #fff;
}
.sof-header .sof-btn.primary:hover { background: #4f6de6; }

/* 本文側はヘッダー分の余白を確保 */
.sofia-page-wrap {
  padding-top: calc(var(--sof-header-h) + 12px);
}



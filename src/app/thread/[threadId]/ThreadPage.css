/* ===================================================================
   ThreadPage : スコープ
   すべて .thread-shell .thread-page の配下に限定
=================================================================== */
.thread-shell .thread-page {
  --bg-soft: #f6edff;
  --line-soft: #ead9ff;
  --card-bg: #fff;
  --card-shadow: 0 1px 2px rgba(0,0,0,.06);
  --radius: 12px;
  --space-s: 8px;
  --space-m: 10px;
  --space-l: 12px;
  --brand-grad: linear-gradient(180deg, #8b5cf6, #7c3aed);
  --yellow-line: #f2cf67;
  --yellow-bg: #fffaf1;
  color: #222;
  background: #fff;
}

/* ===================================================================
   ヘッダー（1行目=戻る / 2行目=アバター+情報）
=================================================================== */
.thread-shell .thread-page .thread-header {
  display: grid;
  grid-template-columns: 44px 1fr;     /* 2行目: avatar / info */
  grid-template-rows: auto auto;       /* 1行目: back / 2行目: avatar+info */
  grid-template-areas:
    "back back"
    "avatar info";
  align-items: start;
  gap: 10px;
  padding: 10px 12px;
  background: var(--bg-soft);
  border-bottom: 1px solid var(--line-soft);
  position: sticky;
  top: 0;
  z-index: 5;
}

/* フル幅の戻るボタン（1行目） */
.thread-shell .thread-page .thread-header .back-btn {
  grid-area: back;
  justify-self: stretch;
  text-align: center;
  appearance: none;
  border: none;
  background: #fff;
  padding: 8px 12px;
  border-radius: var(--radius);
  cursor: pointer;
  font-weight: 700;
  box-shadow: 0 1px 0 rgba(0,0,0,0.06);
}
.thread-shell .thread-page .thread-header .back-btn:hover { filter: brightness(0.98); }

/* 2行目: アバター + 情報 */
.thread-shell .thread-page .thread-header img.avatar {
  grid-area: avatar;
  width: 44px;
  height: 44px;
  border-radius: 50%;
  object-fit: cover;
  background: none;
}

.thread-shell .thread-page .thread-header .header-info {
  grid-area: info;
  display: grid;
  gap: 4px;
}

.thread-shell .thread-page .header-title {
  display: flex;
  gap: 10px;
  align-items: baseline;
}
.thread-shell .thread-page .header-title > strong { font-weight: 700; }
.thread-shell .thread-page .header-title > small  { color: #888; font-size: 12px; }

.thread-shell .thread-page .header-text {
  margin-top: 2px;
  font-size: 14px;
  line-height: 1.5;
  overflow: hidden;
  display: -webkit-box;
  -webkit-line-clamp: 2;
  -webkit-box-orient: vertical;
}

/* ===================================================================
   親のリアクション（黄色枠）— Self寄せ＋中央寄せ
=================================================================== */
.thread-shell .thread-page .parent-like-box {
  display: flex;
  justify-content: center;     /* 中央寄せ */
  align-items: center;
  gap: 8px;
  margin-top: 8px;
  padding: 6px 8px;
  border: 1.5px solid var(--yellow-line);
  border-radius: 10px;
  background: var(--yellow-bg);
  overflow-x: auto;             /* はみ出し時は横スクロール */
  scrollbar-width: thin;
}

/* ===================================================================
   子リスト領域
=================================================================== */
.thread-shell .thread-page .thread-scroll {
  overflow-y: auto;
  padding: 8px 0 180px;         /* 画面下の入力固定ぶんの逃げ */
}

/* 投稿カード（Self寄せ） */
.thread-shell .thread-page .post {
  background: var(--card-bg);
  border-radius: var(--radius);
  box-shadow: var(--card-shadow);
  padding: 8px 10px;
  margin: 10px 0 12px 0;        /* 左0で最左寄せ */
}

.thread-shell .thread-page .author-line {
  display: grid;
  grid-template-columns: 32px 1fr;
  gap: 8px;
  align-items: center;
  margin-bottom: 4px;
}

/* 子コメントのアバター */
.thread-shell .thread-page .post .avatar.child {
  width: 32px;
  height: 32px;
  border-radius: 50%;
  object-fit: cover;
  background: none;
}

/* 本文 */
.thread-shell .thread-page .post .content {
  font-size: 14px;
  line-height: 1.6;
  white-space: pre-wrap;
  word-break: break-word;
}

/* ===================================================================
   リアクションバー（親子共通で中央寄せ）
=================================================================== */
.thread-shell .thread-page .reaction-row,
.thread-page .post .reaction-row,
.reaction-bar {
  display: flex;
  justify-content: center;      /* 中央寄せ */
  align-items: center;
  gap: 6px;
  flex-wrap: nowrap;
  width: 100%;
  margin-top: 8px;
}

/* ===================================================================
   入力ボックス（画面下固定）
=================================================================== */
.thread-shell .thread-page .post-form {
  position: fixed;
  left: 50%;
  transform: translateX(-50%);
  bottom: 56px;                 /* タブバーが無ければ 0 に */
  z-index: 1000;
  max-width: 480px;
  width: 100%;
  display: grid;
  grid-template-columns: 1fr 84px;
  gap: 8px;
  padding: 10px 12px calc(10px + env(safe-area-inset-bottom));
  background: #fff;
  border-top: 1px solid #ececec;
  box-shadow: 0 -4px 16px rgba(0,0,0,.06);
}

.thread-shell .thread-page .post-form textarea {
  height: 44px;
  resize: none;
  padding: 8px 10px;
  border: 1px solid #ddd;
  border-radius: 10px;
  font-size: 14px;
}

.thread-shell .thread-page .post-form button {
  height: 44px;
  border: none;
  border-radius: 10px;
  background: var(--brand-grad);
  color: #fff;
  font-weight: 700;
  cursor: pointer;
  transition: transform .06s ease;
}
.thread-shell .thread-page .post-form button:active { transform: translateY(1px); }
.thread-shell .thread-page .post-form button:disabled { opacity: .5; cursor: not-allowed; }

/* ===================================================================
   細かい調整
=================================================================== */
.thread-shell .thread-page .muted { color: #888; }
.thread-shell .thread-page .sep   { height: 1px; background: #f0f0f0; margin: 8px 0; }

/* iOSの横スクロールバー目立ちすぎ対策 */
.thread-shell .thread-page .parent-like-box::-webkit-scrollbar,
.thread-shell .thread-page .thread-scroll::-webkit-scrollbar { height: 6px; width: 6px; }
.thread-shell .thread-page .parent-like-box::-webkit-scrollbar-thumb,
.thread-shell .thread-page .thread-scroll::-webkit-scrollbar-thumb {
  background: rgba(0,0,0,.15);
  border-radius: 999px;
}

/* ===================================================================
   モバイル微調整
=================================================================== */
@media (max-width: 360px) {
  .thread-shell .thread-page .post-form {
    grid-template-columns: 1fr 76px;
  }
  .thread-shell .thread-page .thread-header {
    gap: 8px;
    padding: 8px 10px;
  }
}

/* --- 1) 投稿カードは block のまま（gridにしない） --- */
.thread-shell .thread-page .post {
  background: #fff;
  border-radius: 12px;
  box-shadow: 0 1px 2px rgba(0,0,0,.06);
  padding: 8px 10px;
  margin: 10px 0 12px 0;
  display: block;                 /* ← ここを block に戻す */
}

/* --- 2) ヘッダー行（アバター/右側）のみ grid で2列 --- */
.thread-shell .thread-page .author-line {
  display: grid;
  grid-template-columns: 32px 1fr; /* 左=アバター / 右=名前・時間 */
  gap: 8px;
  align-items: center;
  margin-bottom: 4px;
}

/* アバター */
.thread-shell .thread-page .post .avatar.child {
  width: 32px;
  height: 32px;
  border-radius: 50%;
  object-fit: cover;
  background: none;
}

/* --- 3) 本文はアバター分だけインデントして、名前の頭と揃える --- */
.thread-shell .thread-page .post .content {
  font-size: 14px;
  line-height: 1.6;
  white-space: pre-wrap;
  word-break: break-word;
  margin-left: 40px;              /* 32(avatar) + 8(gap) = 40px */
}

/* --- 4) いいね行は中央寄せ。インデントはしない --- */
.thread-shell .thread-page .reaction-row,
.reaction-bar {
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 6px;
  flex-wrap: nowrap;
  width: 100%;
  margin-top: 8px;
}

/* --- 5) 親の黄色枠も中央寄せ（そのまま） --- */
.thread-shell .thread-page .parent-like-box {
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 8px;
  margin-top: 8px;
  padding: 6px 8px;
  border: 1.5px solid #f2cf67;
  border-radius: 10px;
  background: #fffaf1;
  overflow-x: auto;
  scrollbar-width: thin;
}

/* （任意）本文が空行から始まる時に余白が詰みすぎるのを軽減 */
.thread-shell .thread-page .post .content p:first-child { margin-top: 0; }


/* コメント本文とリアクション群の区切り線 */
.thread-shell .thread-page .post .content {
  font-size: 14px;
  line-height: 1.6;
  white-space: pre-wrap;
  word-break: break-word;
  margin-left: 40px;              /* 名前と頭揃え */
  padding-bottom: 6px;            /* 線との間に少し余白 */
  border-bottom: 1px solid #eee;  /* ← 区切り線 */
}

/* ====== 下部タブバーの高さ（実寸に合わせて調整） ====== */
:root { --tabbar-h: 72px; }  /* 64〜80px など、環境に合わせて */

.thread-page {
  position: relative;
  min-height: 100dvh;
}

/* ---------- 戻るボタン ----------- */
.back-btn {
  --bd: rgba(0,0,0,.08);
  --glow: rgba(132,94,247,.18);
  display: inline-flex;
  align-items: center;
  gap: 8px;
  padding: 8px 14px;
  border-radius: 999px;
  border: 1px solid var(--bd);
  background: linear-gradient(180deg, #fff, #f7f4ff);
  box-shadow: 0 1px 2px rgba(0,0,0,.06);
  font-weight: 600;
  color: #5b4b8a;
  cursor: pointer;
  transition: box-shadow .15s ease, transform .05s ease, border-color .2s;
  user-select: none;
}
.back-btn:hover {
  box-shadow: 0 0 0 3px var(--glow);
  border-color: rgba(132,94,247,.35);
}
.back-btn:active { transform: translateY(1px); }

/* トップバー（戻るボタンを収める行） */
.thread-topbar {
  padding: 8px 12px;
}

/* ---------- スクロール領域（下に余白を確保） ---------- */
.thread-scroll {
  /* 既存の指定があれば併存でOK */
  padding-bottom: calc(var(--tabbar-h) + 100px + env(safe-area-inset-bottom));
  /* コメント入力が固定で重ならないように、少し大きめに確保 */
}


:root { --tabbar-h: 72px; } /* 下ナビ高さに合わせて調整 */

.thread-scroll{
  padding-bottom: calc(var(--tabbar-h) + 120px + env(safe-area-inset-bottom));
}

/* ← body 直下に出るので確実に画面基準で固定される */
#comment-dock.post-form{
  position: fixed;
  left: 50%;
  transform: translateX(-50%);
  bottom: calc(var(--tabbar-h) + env(safe-area-inset-bottom) + 8px);
  width: min(900px, 100% - 24px);
  z-index: 1000;

  display: flex;
  gap: 8px;
  align-items: center;
  background: #fff;
  border: 1px solid rgba(0,0,0,.08);
  border-radius: 14px;
  padding: 10px;
  box-shadow: 0 6px 24px rgba(0,0,0,.08);
}

#comment-dock.post-form textarea{
  flex: 1 1 auto;
  min-height: 36px;
  max-height: 96px;
  padding: 8px 10px;
  border: 1px solid rgba(0,0,0,.06);
  border-radius: 10px;
  resize: none;
  outline: none;
}

#comment-dock.post-form button{
  padding: 10px 14px;
  border-radius: 10px;
  border: 0;
  background: #b197fc;
  color: #fff;
  font-weight: 700;
  cursor: pointer;
}

.delete-btn{
  margin-left: 8px;
  padding: 2px 8px;
  font-size: 12px;
  border: 1px solid #e3a5ad;
  color: #c62828;
  background: #fff5f6;
  border-radius: 10px;
  cursor: pointer;
}
.delete-btn:hover{ background: #ffecee; }


.thread-header .header-info { position: relative; }
.thread-header .delete-btn{
  position: absolute;
  right: 8px;
  top: 6px;
  padding: 2px 8px;
  font-size: 12px;
  border: 1px solid #e3a5ad;
  color: #c62828;
  background: #fff;
  border-radius: 999px;
  cursor: pointer;
  opacity: .9;
}
.thread-header .delete-btn:hover { background: #fff5f6; opacity: 1; }

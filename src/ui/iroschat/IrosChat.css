/* src/ui/iroschat/IrosChat.css */
/* Iros専用（中身はSofiaChat.cssと同等に） */
@charset "utf-8";

/* =========================================================
   固定ヘッダー／トップ余白
   ========================================================= */
.sof-header-fixed {
  position: fixed !important;
  top: 0;
  left: 0;
  right: 0;
  z-index: 2000;
  background: #fff !important;
  backdrop-filter: none !important;
  -webkit-backdrop-filter: none !important;
}

/* =========================================================
   入力欄の「台座」(下部固定)
   ========================================================= */
.sof-compose-dock {
  position: sticky;
  bottom: env(safe-area-inset-bottom, 0);
  z-index: 1000;
  background: #fff;
  box-shadow: 0 -6px 18px rgba(0, 0, 0, 0.06);
}

/* =========================================================
   メタ領域・パネル
   ========================================================= */
.sof-meta-dock {
  position: relative;
  z-index: 0;
}
.meta-panel {
  position: relative;
  z-index: 0;
  margin-bottom: calc(var(--sof-compose-h, 96px) + 12px);
}

/* =========================================================
   メッセージエリア（入力欄に隠れない余白）
   - ここは “レイアウト専用”
   - 行間/段落余白/見出し等のタイポは ChatMarkdown.css に集約する
   ========================================================= */
.sof-msgs {
  padding-bottom: max(40vh, calc(var(--sof-compose-h, 100px) + 24px));
  padding-left: 4px;
  padding-right: 4px;
}

/* =========================================================
   画面の器（必要なら定義）
   ========================================================= */
/* 画面の器：PCでも横幅制限をしない */
.sofia-container {
  max-width: none !important;
  width: 100% !important;
  margin: 0 !important;
  padding: 0 12px;
}

/* =========================================================
   オーバーレイ系は初期無効化（覆って固まる事故を防ぐ）
   ========================================================= */
.sof-underlay,
.sof-dim {
  pointer-events: none;
  opacity: 0;
}

/* =========================================================
   ルート変数（共通トークン）
   ========================================================= */
:root {
  --footer-safe-pad: 56px;
  --safe-bottom: env(safe-area-inset-bottom, 0px);
  --chat-offset: 12px;

  /* アシスタント吹き出し（既定） */
  --sofia-a-fs: 15px;
  --sofia-a-lh: 1.85;
  --sofia-a-radius: 16px;
  --sofia-a-border: 1px solid #e6eaf2;
  --sofia-a-shadow: 0 1px 3px rgba(16, 24, 40, 0.06),
    0 8px 24px rgba(2, 6, 23, 0.05);
  --sofia-a-bg-grad: linear-gradient(180deg, #ffffff 0%, #f7f9fc 100%);

  /* ユーザー吹き出し（既定） */
  --sofia-u-border: 1px solid #cfe0ff;
  --sofia-u-bg-grad: linear-gradient(180deg, #ffffff 0%, #eef5ff 100%);
  --sofia-u-shadow: 0 1px 3px rgba(16, 24, 40, 0.06),
    0 8px 24px rgba(30, 64, 175, 0.06);

  /* バブル最大幅（MessageList用） */
  --bubble-max-w: 720px;

  /* drawer（必要なら） */
  --drawer-z: 1200;
  --drawer-width: min(90vw, 360px);
}

/* =========================================================
   追加の安全ガード（任意）
   ========================================================= */
.sof-footer-spacer {
  height: calc(var(--safe-bottom, 0px) + 8px);
}
.iro-chat-bg {
  pointer-events: none;
}

/* メッセージ吹き出しの共通最大幅（MessageList 側 inline-style と同等） */
.sof-bubble-custom {
  max-width: min(var(--bubble-max-w, 780px), 86%);
}

/* =========================================================
   Message layout（行間・余白などタイポは触らない）
   ========================================================= */
.message {
  display: flex;
  flex-direction: column;
  gap: 8px;
  margin-bottom: 10px;
}
.message.is-user {
  align-items: flex-end;
}
.message.is-assistant {
  align-items: flex-start;
}

/* 吹き出し（ベース） */
.bubble {
  border-radius: 16px;
  padding: 12px 14px;
  background: linear-gradient(180deg, #ffffff 0%, #f7f9fc 100%);
  border: 1px solid #e6eaf2;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
  color: #0f172a;
}

/* 吹き出し間を自然に */
.message + .message {
  margin-top: 12px;
}

/* =========================================================
   Assistant（バブル無し：フラット表示）
   - タイポは ChatMarkdown.css の .iros-p / .iros-heading-line に任せる
   ========================================================= */
.sof-msgs .message.is-assistant .bubble {
  background: none !important;
  border: none !important;
  box-shadow: none !important;
  padding: 0 !important;
  max-width: 100% !important;
}

/* 行の左右にすこしだけ余白（レイアウトだけ） */
.sof-msgs .message.is-assistant {
  width: 100% !important;
  padding: 0 10px 0 6px !important;
}

/* msgBody は “器” だけ（本文の line-height / margin は入れない） */
.sof-msgs .message.is-assistant .msgBody {
  max-width: var(--bubble-max-w, 720px);
  font-size: var(--sofia-a-fs, 15px);
  color: #222;
}

/* Iros：Qバッジの縦位置を少し下げる */
.sof-msgs .message.is-assistant .q-badge {
  margin-top: 6px !important;
  transform: translateY(2px);
}

/* =========================================================
   User bubble（ultra-light MUVERSE）
   ========================================================= */
.message.is-user .bubble {
  background: linear-gradient(
    180deg,
    rgba(230, 230, 255, 0.4),
    rgba(245, 245, 255, 0.25)
  ) !important;

  border: 1px solid rgba(170, 150, 255, 0.28) !important;
  box-shadow: 0 4px 16px rgba(120, 100, 255, 0.1) !important;

  color: #333 !important;
  padding: 14px 16px !important;

  backdrop-filter: blur(6px) !important;
  -webkit-backdrop-filter: blur(6px) !important;
}

/* =========================================================
   IMPORTANT: 本文タイポの上書き禁止
   - Markdown の段落/見出し/リスト/引用/HR は ChatMarkdown.css に集約
   - ここでは “p の行間/余白” を書かない（競合を作らない）
   ========================================================= */

/* ただし、壊れ防止の最低限だけ必要ならこれだけ残す（行間は触らない） */
.msgBody p {
  white-space: pre-wrap;
  word-break: break-word;
  margin: 0;
}

/* =========================================================
   Mobile adjustments（レイアウトだけ）
   ========================================================= */
@media (max-width: 600px) {
  .message {
    margin-bottom: 28px;
  }
  /* モバイル時に msgBody 側で line-height を上げない（本文側に任せる） */
}
